{% extends 'base.html' %}
{% load static %}
{% block title %}Prayer Request - DailyVotion{% endblock %}
{% block head_css %}
<link rel="stylesheet" href="{% static 'css/User/Userprayerrequest.css' %}">
{% endblock %}
{% block content %}
<div class="userprayerrequest-container">
  <div class="userprayerrequest-main">
    <div class="userprayerrequest-content-paper">
      <div class="userprayerrequest-title">Add Prayer Request</div>
      <div class="userprayerrequest-explanation">Type your prayer request below. It will be sent to the admin for review and response.</div>
      <form method="post">
        {% csrf_token %}
        {{ form.text }}
        <div class="userprayerrequest-btns">
          <button class="userprayerrequest-btn" type="submit">Submit</button>
        </div>
      </form>
      {% if requests %}
      <div class="userprayerrequest-list">
        {% for r in requests %}
        <div class="userprayerrequest-item">
          <div class="userprayerrequest-date">{{ r.created_at|date:'Y-m-d' }}</div>
          <div>{{ r.text }}</div>
          {% if r.admin_response %}
            <button class="userprayerrequest-response-btn" type="button" onclick="this.nextElementSibling.classList.toggle('open')">View Admin Response</button>
            <div class="userprayerrequest-response">
              <div class="userprayerrequest-response-meta">Responded {{ r.responded_at|date:'Y-m-d H:i' }}</div>
              <div>{{ r.admin_response }}</div>
            </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
  // Prevent double submission by disabling submit button on submit
  const uprForm = document.querySelector('.userprayerrequest-content-paper form');
  if (uprForm) {
    uprForm.addEventListener('submit', (e) => {
      const btn = uprForm.querySelector('.userprayerrequest-btn');
      if (btn) { btn.disabled = true; btn.textContent = 'Submitting...'; }
    });
  }
</script>
{% endblock %}
