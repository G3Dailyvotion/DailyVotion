{% extends 'base.html' %}
{% load static %}
{% block title %}Manage Users - DailyVotion{% endblock %}
{% block body_class %}admin-page{% endblock %}
{% block hide_navbar %}navbar-hidden{% endblock %}
{% block head_css %}
<link rel="stylesheet" href="{% static 'css/Admin/ManageUser.css' %}">
<link rel="stylesheet" href="{% static 'css/Admin/AdminDashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/Admin/admin-common.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}
{% block content %}
<div class="manageuser-container-fresh">
  <!-- Admin Topbar -->
  <div class="admindash-topbar">
    <div class="admindash-logo">DailyVotion Admin</div>
    <ul class="admindash-menu">
      <li><a href="{% url 'admin_dashboard' %}"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </div>

  <div class="manageuser-main-fresh">
    <h1 class="manageuser-title">Manage Users</h1>

    <div class="admin-nav">
      <a href="{% url 'admin_dashboard' %}" class="nav-link">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
    <div class="manageuser-sections">
      <div class="manageuser-admins-fresh">
        <h2>Admin Accounts</h2>
  <ul class="list-reset">
          {% for u in admins %}
          <li class="manageuser-user-item-fresh">
            <div style="display:flex;align-items:center;gap:.7rem"><strong>{{ u.get_full_name|default:u.username }}</strong></div>
            <div style="margin-top:.3rem">{{ u.email }}</div>
            <div>Role: Admin</div>
            <div class="manageuser-actions-fresh">
              <form method="post" style="display:inline-block">
                {% csrf_token %}
                <input type="hidden" name="action" value="toggle_role"/>
                <input type="hidden" name="user_id" value="{{ u.id }}"/>
                <button type="submit">Change to User</button>
              </form>
              <form method="post" style="display:inline-block" onsubmit="return confirm('Delete this admin account?');">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete_user"/>
                <input type="hidden" name="user_id" value="{{ u.id }}"/>
                <button type="submit">Delete Admin Account</button>
              </form>
            </div>
          </li>
          {% empty %}
          <li class="manageuser-user-item-fresh">No admin accounts yet.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="manageuser-users-fresh">
        <h2>User Accounts</h2>
  <ul class="list-reset">
          {% for u in users %}
          <li class="manageuser-user-item-fresh">
            <div style="display:flex;align-items:center;gap:.7rem"><strong>{{ u.get_full_name|default:u.username }}</strong></div>
            <div style="margin-top:.3rem">{{ u.email }}</div>
            <div>Role: User</div>
            <div class="manageuser-actions-fresh">
              <form method="post" style="display:inline-block">
                {% csrf_token %}
                <input type="hidden" name="action" value="toggle_role"/>
                <input type="hidden" name="user_id" value="{{ u.id }}"/>
                <button type="submit">Make Admin</button>
              </form>
              <form method="post" style="display:inline-block" onsubmit="return confirm('Delete this user account?');">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete_user"/>
                <input type="hidden" name="user_id" value="{{ u.id }}"/>
                <button type="submit">Delete Account</button>
              </form>
            </div>
          </li>
          {% empty %}
          <li class="manageuser-user-item-fresh">No user accounts yet.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
  const mbtn=document.getElementById('mu-menu-btn');const mm=document.getElementById('mu-menu');if(mbtn&&mm){mbtn.addEventListener('click',()=>{mm.style.display=mm.style.display==='none'?'block':'none';});}
</script>
{% endblock %}
