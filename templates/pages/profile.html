{% extends 'base.html' %}
{% load static %}
{% block title %}Profile - DailyVotion{% endblock %}
{% block head_css %}
<link rel="stylesheet" href="{% static 'css/User/UserProfile.css' %}">
{% endblock %}
{% block content %}
<div class="profilepage-container">
  <div class="profilepage-main-vertical">
    <div class="profilepage-content-paper" style="box-shadow:0 8px 32px 0 rgba(0,0,0,0.22),0 2px 8px 0 rgba(0,0,0,0.14);">
      <div class="profilepage-user-vertical">
        {% if request.user.is_authenticated %}
          {% with profile=request.user.profile %}
            <img src="{{ profile.get_image_url }}" alt="Profile Picture" class="profilepage-avatar" />
          {% endwith %}
        {% else %}
          <img src="{% static 'pictures/Profilepic.jpg' %}" alt="Default Profile" class="profilepage-avatar" />
        {% endif %}
        <h2 class="profilepage-username">{{ request.user.get_full_name|default:request.user.username }}</h2>
        <p class="profilepage-userid">@{{ request.user.username }}</p>
      </div>

      <div class="profilepage-buttons-grid profilepage-buttons-spaced">
        <a href="{% url 'edit_profile' %}"><button>Edit Profile</button></a>
        <a href="{% url 'journal' %}"><button>Journal</button></a>
        <a href="{% url 'user_prayer_request' %}"><button>Add Prayer Request</button></a>
      </div>
      <div class="profilepage-buttons-grid" style="margin-bottom:2.2rem; grid-template-columns:repeat(2,minmax(0,1fr));">
        <a href="{% url 'user_reflection' %}"><button>Reflection</button></a>
        <a href="{% url 'user_feedback' %}"><button>App Feedback</button></a>
      </div>

      <div class="profilepage-section" style="margin-bottom:1.2rem;">
        <div id="verse-of-day" class="profilepage-post" style="background:#e0f7fa;color:#008b8b;font-size:1.1rem;font-weight:500;text-align:center;cursor:pointer;box-shadow:none;" tabindex="0">
          <span style="display:block;margin-bottom:0.3rem;">Verse of the Day</span>
          <span style="font-style:italic;">"Philippians 4:13 - I can do all things through Christ who strengthens me."</span>
        </div>
      </div>
      <div id="verse-modal" class="profilepage-modal hidden" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:#fff;padding:2rem 2.5rem;border-radius:16px;max-width:400px;box-shadow:0 4px 24px rgba(0,0,0,0.18);text-align:center;">
          <h3 style="margin-top:0;">Verse of the Day</h3>
          <div style="font-style:italic;color:#008b8b;font-size:1.1rem;">"Philippians 4:13 - I can do all things through Christ who strengthens me."</div>
          <button onclick="document.getElementById('verse-modal').classList.add('hidden');" style="margin-top:1.5rem;padding:0.5rem 1.2rem;background:#008b8b;color:#fff;border:none;border-radius:6px;cursor:pointer;">Close</button>
        </div>
      </div>

      <div class="profilepage-section">
        <a href="{% url 'journal' %}" style="text-decoration:none;color:inherit;">
          <div id="recent-journal-box" class="profilepage-post profilepage-post-clickable" style="box-shadow:none;transition:box-shadow 0.2s;cursor:pointer;" tabindex="0">
            <h3 style="margin-top:0;">Recent Journal</h3>
            {% if recent_post %}
              <p class="profilepage-date">{{ recent_post.date|date:'M j, Y' }}</p>
              {% if recent_post.scripture %}<p class="profilepage-content">{{ recent_post.scripture }}</p>{% endif %}
              {% if recent_post.observation %}<p class="profilepage-content">{{ recent_post.observation|truncatechars:160 }}</p>{% endif %}
            {% else %}
              <p class="profilepage-content">No journal entries yet.</p>
            {% endif %}
          </div>
        </a>
      </div>

      <div class="profilepage-section">
        <div class="profilepage-post" style="box-shadow:none;transition:box-shadow 0.2s;">
          <h3 style="margin-top:0;">Recent Prayer Requests</h3>
          {% if recent_prayers %}
            <ul class="list-reset">
              {% for p in recent_prayers %}
              <li>
                <span class="profilepage-date">{{ p.created_at|date:'Y-m-d' }}</span>
                <div>{{ p.text|truncatechars:140 }}</div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="profilepage-content">No prayer requests yet.</p>
          {% endif %}
        </div>
      </div>

      <div class="profilepage-section">
        {% if recent_reflections %}
        <div class="profilepage-post">
          <h3 style="margin-top:0;">Recent Reflections</h3>
          <ul class="list-reset" style="padding-left:0; margin-bottom:0;">
            {% for r in recent_reflections %}
            <li style="display:flex;align-items:flex-start;gap:1.2rem;margin-bottom:0.7rem;">
              <span class="profilepage-date" style="min-width:90px;text-align:left;">{{ r.created_at|date:'Y-m-d' }}</span>
              <div class="profilepage-content" style="flex:1;">{{ r.text|truncatechars:160 }}</div>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% else %}
        <div class="profilepage-post"><h3 style="margin-top:0;">Recent Reflections</h3><p class="profilepage-content">No reflections yet.</p></div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
  // Verse of the Day modal logic
  const verseBox = document.getElementById('verse-of-day');
  const verseModal = document.getElementById('verse-modal');
  if (verseBox && verseModal) {
    verseBox.addEventListener('click', () => {
      verseModal.classList.remove('hidden');
    });
    verseBox.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        verseModal.classList.remove('hidden');
      }
    });
  }
</script>
{% endblock %}
